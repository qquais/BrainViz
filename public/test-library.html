<!DOCTYPE html>
<html>
<head>
  <title>Minimal EDF Test</title>
</head>
<body>
  <h1>Minimal EDF File Test</h1>
  <input type="file" id="fileInput" accept=".edf">
  <div id="result">Select an EDF file to test...</div>
  
  <script src="libs/plotly.min.js"></script>
  <script src="libs/edfdecoder.js"></script>
  <script>
    document.getElementById('fileInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      console.log('üìÅ File selected:', file.name, file.size, 'bytes');
      document.getElementById('result').innerHTML = 'Processing...';
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          console.log('üìÑ File read, size:', e.target.result.byteLength);
          
          // Test EDF processing
          const decoder = new edfdecoder.EdfDecoder();
          console.log('‚úÖ Decoder created');
          
          decoder.setInput(e.target.result);
          console.log('‚úÖ Input set');
          
          decoder.decode();
          console.log('‚úÖ Decode completed');
          
          const edfData = decoder.getOutput();
          console.log('‚úÖ Output retrieved:', edfData);
          
          if (!edfData) {
            throw new Error('Decoder returned null');
          }
          
          // Test method calls
          const numSignals = edfData.getNumberOfSignals();
          const numRecords = edfData.getNumberOfRecords();
          console.log('üìä Signals:', numSignals, 'Records:', numRecords);
          
          if (numSignals > 0) {
            const signalLabel = edfData.getSignalLabel(0);
            const sampleRate = edfData.getSignalSamplingFrequency(0);
            const physicalUnit = edfData.getSignalPhysicalUnit(0);
            
            console.log('üéØ Signal 0:', signalLabel, sampleRate + 'Hz', physicalUnit);
            
            // Try to get signal data
            const signalData = edfData.getPhysicalSignalConcatRecords(0, 0, Math.min(numRecords, 2));
            console.log('üìà Signal data length:', signalData.length);
            
            document.getElementById('result').innerHTML = `
              <h3>‚úÖ EDF Processing Successful!</h3>
              <p><strong>Signals:</strong> ${numSignals}</p>
              <p><strong>Records:</strong> ${numRecords}</p>
              <p><strong>First Signal:</strong> ${signalLabel}</p>
              <p><strong>Sample Rate:</strong> ${sampleRate} Hz</p>
              <p><strong>Unit:</strong> ${physicalUnit}</p>
              <p><strong>Data Points:</strong> ${signalData.length}</p>
            `;
          }
          
        } catch (error) {
          console.error('‚ùå Processing failed:', error);
          document.getElementById('result').innerHTML = `
            <h3>‚ùå Error Processing EDF</h3>
            <p>${error.message}</p>
            <p>Check console for details</p>
          `;
        }
      };
      
      reader.readAsArrayBuffer(file);
    });
  </script>
</body>
</html>